---
title: "CV Dashboard"
author: "Noah Pollock"
date: "December 30, 2018"
output: 
  html_document:
    code_folding: none
    toc: no
---


<button title="" class="btn btn-secondary" type="button" data-original-title="Popover Title" data-toggle="popover" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-placement="right" data-container="body">Right</button>

<button title="" class="btn btn-secondary" type="button" data-original-title="Tooltip on right" data-toggle="tooltip" data-placement="right">Right</button>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(leaflet)
library(highcharter)
library(dplyr)
library(tidyr)
library(lubridate)

color_temp <- c("#ffa500","#1a6ecc", "#434348", "#90ed7d","#323232","#000000")


thm <- 
  hc_theme(
    colors = color_temp,
    chart = list(
      backgroundColor = "transparent",
      style = list(fontFamily = "Source Sans Pro")
    ),
    xAxis = list(
      gridLineWidth = 1
    )
  )

cv_df <- read.csv('cv_df.csv',
                  stringsAsFactors = FALSE,
                  na.strings = "") %>%
  mutate(date_end = as.Date(date_end),
         date_start = as.Date(date_start))

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Testing Tabs: {.tabset data-width=400}

###Three column layout
<div class="row">
  <div class="col-md-9">
```{r present_map}
pdata <- cv_df %>%
  filter(section == "Presentations") %>%
  group_by(lat,lon) %>%
  summarise(Count = n(),
            tooltip = paste(experience,collapse = "<br><br>"))
  
leaflet() %>% 
  addTiles() %>%
  addCircleMarkers(
    data = pdata,
    lat = ~lat, lng = ~lon,
    color = "blue",
    weight = 1,
    fillOpacity = .6,
    radius = ~(Count*3),
    stroke = FALSE,
    popup = ~paste0("Presentations: ",Count,"<br>",
                   tooltip),
    labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"))
```
  </div>
  <div class="col-md-3" style="background-color: orange;">
  <p style="text-align:center;">Total Presentations<br><br><strong>
`r cv_df %>% filter(section == "Presentations") %>% nrow()`  
</strong></p>
  </div>
</div>
```{r}

pdata <- cv_df %>%
  filter(section=="Skills") %>%
  mutate(date_end = if_else(is.na(date_end),Sys.Date(),date_end),
         Months = (interval(as.Date(date_start),as.Date(date_end)) %/% months(1)))

# create side-by-side bar charts for each institution type
lapply(unique(pdata$category),function(skill_cat){
  
  # set each  chart with different color bars
  color_select = color_temp[
    (pdata %>% distinct(category) %>% mutate(index = 1:n()) %>% filter(category==skill_cat))$index
  ]
  
  pdata %>%
    arrange(desc(Months)) %>%
    filter(category == skill_cat) %>%
    select(experience,Months) %>%
    hchart("bar",hcaes(x="experience",y="Months"),color=color_select) %>%
    hc_add_theme(thm) %>%
    hc_title(text = skill_cat) %>%
    hc_xAxis(title = NA)
}) %>%
  hw_grid(rowheight = 250,
          ncol = length(unique(pdata$category)))
# ncol = ceiling(length(unique(pdata$category))/2)
```  

###Two column layout
<div class="row">
  <div class="col-md-9">
```{r cars}
pdata <- cv_df %>%
  filter(section == "Presentations") %>%
  group_by(lat,lon) %>%
  summarise(Count = n(),
            tooltip = paste(experience,collapse = "<br><br>"))
  
leaflet() %>% 
  addTiles() %>%
  addCircleMarkers(
    data = pdata,
    lat = ~lat, lng = ~lon,
    color = "blue",
    weight = 1,
    fillOpacity = .6,
    radius = ~(Count*3),
    stroke = FALSE,
    popup = ~paste0("Presentations: ",Count,"<br>",
                   tooltip),
    labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"))
```
  </div>
  <div class="col-md-3" style="background-color: orange;">
  <p style="text-align:center;">Total Presentations<br><br><strong>
`r cv_df %>% filter(section == "Presentations") %>% nrow()`  
</strong></p>
  </div>
</div>
