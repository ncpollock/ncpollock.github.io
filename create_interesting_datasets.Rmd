---
title: "Create Interesting Datasets"
author: "Noah Pollock"
date: "November 14, 2018"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE)
```

## Scope
I needed a dataset, so I created one!

## Introduction and Prerequisites

I co-taught then solo-taught the pre-conference workshop at the Michigan Association for Institutional Research in 2017 and 2018. The topic was an introduction to R. I knew I needed a dataset that would engage my audience. It had to be relevent to their work as professionals in higher education. I could have dumped some data from our database and deidentified it, but instead I thought I would cease the opportunity as a learning tool. I created my own dataset with *interesting* qualities. By interesting, I mean statistical effects such as mean differences between groups, variables that explain variability in other variables (and perhaps at variable levels!), and the ability to be charted and graphed in fun or useful ways.

For this post, we'll create these datasets purely with base R functions. However, I use `ggplot2` to show how the dataset is interesting with plots.

A few good reasons to create your own dataset:

* Mocking up visualizations
* Testing our understanding of statistics
* Simulations (e.g., probabilities or algorithms)
* Teaching

A few bad reasons:

* You didn't get enough responses to your survey
* Your effects are too small and p-values to large to publish

## Create the Dataset

```{r init_data}

set.seed(100) #specify number generator for 'random' numbers for reproducibility
n_students <- 1000 #number of grads
terms <- sort(rep(c(paste0(2014:2018,"10"),paste0(2013:2017,"40")),n_students))
n_terms <- length(unique(terms)) #number of terms generate
air_df <- data.frame(
  student_id = 1:(n_students*n_terms),
  term_code = terms,
  school = sample(c("BA","AS","EG"),size=n_students*n_terms,replace=TRUE),
  ATYP = rep(sample(c("F","T"),size=n_students,replace=TRUE),n_terms),
  sex = rep(sample(c("M","F"),prob=c(.55,.45),size=n_students,replace=TRUE),n_terms),
  residency = rep(sample(c("I","O"),size=n_students,replace=TRUE),n_terms),
  career_use = round(runif(n_students*n_terms,0,10)),
  post_grad_outcome = sample(c("Employed","Grad School","Still Seeking","Other"),prob=c(.64,.27,.07,.02),size=n_students*n_terms,replace=TRUE),
  
  # these vars are placeholders
  gpa = 0,
  salary = 0,
  stringsAsFactors = FALSE
)
air_df$gpa <- ifelse(air_df$ATYP=="F",
                     #intercept + slope*value + error/noise
                     #different slopes for a nice interaction effect
                     2.5 + .15*air_df$career_use + rnorm(n_students*n_terms,0,1),
                     3.7 + .01*air_df$career_use + rnorm(n_students*n_terms,0,1))
air_df$gpa = ifelse(air_df$gpa>4,runif(n_students*n_terms,3.2,4),air_df$gpa) # keep gpa under 4
air_df$gpa = ifelse(air_df$gpa<0,runif(n_students*n_terms,0,1),air_df$gpa) # keep gpa above 0

air_df$career_use <- ifelse(air_df$post_grad_outcome=="Employed",
                            #intercept + slope*value + error/noise
                            #different slopes for a nice interaction effect
                            sample(0:10
                                   ,prob=c(3:13)
                                   ,replace=TRUE
                                   ,size=length(
                                     air_df$career_use[air_df$post_grad_outcome=="Employed"])),
                            air_df$career_use)

air_df$salary <- ifelse(air_df$school=="EG",
                        #intercept + slope*value + error/noise
                        #different slopes for a nice interaction effect
                        64000 + 750*air_df$career_use + rnorm(n_students*n_terms,0,1000),
                        ifelse(air_df$school=="AS",
                               48000 + 10*air_df$career_use + rnorm(n_students*n_terms,0,4000),
                               51000 + 400*air_df$career_use + rnorm(n_students*n_terms,0,2700)))
air_df$salary <- ifelse(air_df$post_grad_outcome=="Employed",air_df$salary,NA)

```

```{r basic_plot}
barplot(table(air_df$post_grad_outcome))
```

## Show Interest

Let's visualize how this dataset is interesting. Below, I included a report that I built with this dataset as a teaching tool at the 2018 Pre-conference for the Michigan Association for Institutional Research. Note that a few of the plots and tables below use recoded variables and two other datasets that I created as well. I included the data tidying we performed and one of the other datasets. The other dataset was a simple two column csv file with industries and counts. Eventually, I will create a blog post detailing this report.

```{r main_effects, echo=FALSE, out.width = "100%",out.height="100%"}
library(dplyr)

air_df <- air_df %>%
  rename(admit_type = ATYP) %>%
  mutate(
    school_recode = recode(school,
           "AS" = "Arts and Sciences",
           "BA" = "Business",
           "EG" = "Engineering and Computer Science"),
    year = substr(term_code,1,4),
    term_type = 
      ifelse(
        substr(term_code,5,6)=="10",
        "Winter",
        "Fall"),
    term_desc = 
      ifelse(
        substr(term_code,5,6)=="10",
        paste("Winter",substr(term_code,1,4),sep=" "),
        paste("Fall",substr(term_code,1,4),sep=" ")),
    career_use_bin = ifelse(career_use>0,"Engaged","Did Not Engage"), #use case_when instead?
    pg_outcome_bin = case_when(post_grad_outcome %in% 
                                 c("Employed","Grad School") ~ TRUE
                               ,post_grad_outcome %in% 
                                 c("Still Seeking","Other") ~ FALSE
                               )
    )

roi_df <- data.frame(
  income_source = c("Minimum Wage",
                    "High School Diploma",
                    "Some College",
                    "10 Years after Attending OI",
                    "Bachelors"),
  amount = c(8.15*40*52, # source: Department of Labor Statistics
             26762, # source: https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?src=CF
             31801, # source: Census.gov ^
             43100, # source: college scorecard
             49711) # source: Census.gov ^
,stringsAsFactors = FALSE)

```

<iframe src ="images/oi_report.pdf" height=800px width=600px />

